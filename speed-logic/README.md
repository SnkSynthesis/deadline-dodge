# Speed Logic

This circuitry controls the speed of the [lfsr-decoder-logic](../lfsr-decoder-logic/) and, in turn, how fast the rocks fall in the game. It is a modular feature that introduces three distinct speed levels.

As the game goes forward, the logic increases the speed at which rocks spawn and fall and making the game progressively harder.

## Operation

### Triggering the Speed Increase
An AND gate detects the LFSR state 1111 (inputs: Qa, Qb, Qc, Qd), which occurs at regular intervals. This output increments a [mod-6 counter](./Mod-6_Counter.png) (74LS163N). Although the counter is designed to count up to 6, it is forced to jump to its maximum count (1111) in order to set the RCO pin high, triggering the next stage. The mod-6 counter was an arbitrary choice, which makes the game speed increase after the LFSR has reached state 1111, six times. We could resdesign it to be a mod-8 counter if desired. 
#### How the counter works 
The counter initilizes to 0000 and continues its count to 0011, where the NAND-gate-to-LOAD goes Low and triggers the LOAD, making the counter jump to count 1100, (see [Timing Diagram For Jump](./Timing_For_Jump.png)). Then the counter continues its count. The counter's RCO pin goes high when the counter reaches 1111 and rolls over. The RCO pin triggers the next logic stage. The counter jumps because the RCO pin must go high for this logic stage to trigger the next logic stage. 

### Speed Level Control
The next stage is another 74LS163N counter. Each time the RCO pin goes high on the previous stage, this counter is incremented causing the game speed to increase. Once this second-stage-counter is inremented it must wait for the first-stage-counter's RCO pin to go high before it increments again. See [RCO Speed Increase Diagram](./RCO_Speed_Increase_Diagram.png). After two speed increases, this counter continues to count up, but combinational logic downstream makes all counts 0010 and above lock the game at its highest speed setting. 

### Speed Selection and Distribution
The second-stage-counterâ€™s outputs are decoded with combinational logic to control a 74LS153 4-to-1 multiplexer (MUX).

The MUX selects between three clock inputs:
* Divide-by-4 clock (low speed)
* Divide-by-2 clock (medium speed)
* System clock (full speed)

The two divided clocks are generated by using a counter as a frequency divider (divides by factor of 2 at each output bit position).

The MUX output determines the active game speed. This clock signal is fed back into the game so the relevant game elements operate in sync with the selected tempo. 
The [player-movement-logic](../player-movement-logic) and [collision-logic](../collision-logic) use the system clock for optimal responsiveness. In practice this means that as rocks are falling at slower tempos the player's movement is not restricted to this slow tempo. The player can always move quickly, with the system clock.

## Schematic
![Speed Logic Schematic](Speed_Logic_Schematic.png)

_Screenshot of Speed_Logic.ms14_
